{% extends "base.html" %}

{% block content %}

<section>
  <div class="form-row">
    <a href="/logout" class="link-button"><i class="fas fa-sign-out-alt"></i> Log Out</a>
    <a href="/address_book/new" class="link-button"><i class="fas fa-plus"></i> Add A New Address</a>
  </div>

  <div>
    {% for address in addresses %}
      <div class="address-card" id="address-{{ address.id }}">
        <a href="/address_book/edit/{{ address.id }}" class="card-button edit-button"><i class="far fa-edit"></i></a>
        <p>{{address.first_name}} {{ address.last_name }}</p>
        <p>{{address.address}} {{ address.city }}, {{ address.state }}</p>
        <p>{{ address.zip_code }}</p>
        <button type="button" class="card-button delete-button" data-id="{{ address.id }}" onclick="deleteAddress(event)"><i data-id="{{ address.id }}" class="fas fa-trash-alt delete-btn"></i></button>
      </div>
      {% endfor %}
  </div>
</section>

<script>
  const deleteAddress = async e => {
    e.preventDefault();
    const { target } = e;

    console.log({ target })
    const address_id = target.getAttribute('data-id');

    if (window.confirm("Delete This Address?")) { 
      try {
        const response = await fetch(`api/address_book/edit/${address_id}`, {
          method: 'DELETE',
          headers: {'Content-Type': 'application/json'},
        });

        const result = await response.json();

        if (result.success === true) {
          const addressElement = document.querySelector(`#address-${address_id}`);
          addressElement.remove();
        }
      } catch (err) {
        console.log(err);
      }
    }
  }
</script>

{% endblock %}


